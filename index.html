
<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Solo-Leveling Smart AI Coach</title>
<style>
  body { font-family: sans-serif; background: #0b0c10; color: #e0e0e0; margin: 0; padding: 20px; }
  h2 { color: #66fcf1; }
  input, button, textarea { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: none; }
  input, textarea { background: #1f2833; color: #c5c6c7; }
  button { background: #45a29e; color: white; font-weight: bold; cursor: pointer; }
  .task { border: 1px solid #45a29e; padding: 10px; margin-top: 10px; border-radius: 6px; }
</style>
</head>
<body>
<h2>‚öîÔ∏è Solo-Leveling Smart AI Coach</h2>
<p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (ISO ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá): ‡¶Ø‡ßá‡¶Æ‡¶® <code>2025-11-08T21:00:00</code></p>
<input id="title" placeholder="‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)">
<input id="due" placeholder="Due (ISO)">
<button onclick="addTask()">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>

<h3>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
<div id="tasks">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

<hr/>
<h3>üí¨ Chat (Optional)</h3>
<textarea id="prompt" rows="2" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡ßü)"></textarea>
<button onclick="ask()">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡ßã</button>
<div id="answer"></div>

<script>
const apiBase = location.origin;
const token = '';

async function fetchList(){
  let res = await fetch(apiBase + '/api/list', {headers:{'x-api-key': token}});
  let j = await res.json();
  let html = '';
  j.tasks.forEach((t) => {
    html += `<div class="task">
      <b>${t.title}</b><br/>
      Due: ${t.due}<br/>
      Done: ${t.done} | Nudges: ${t.nudges}<br/>
      <button onclick="complete(${t.doc_id})">‚úÖ Complete</button>
      ${t.audio ? `<button onclick="playAudio('${t.audio}')">üîä Play</button>` : ''}
    </div>`;
  });
  document.getElementById('tasks').innerHTML = html || '‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á';
}

async function addTask(){
  const title = document.getElementById('title').value;
  const due = document.getElementById('due').value;
  if(!title || !due){ alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶∏‡¶Æ‡ßü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®'); return; }
  await fetch(apiBase + '/api/add_task', {
    method:'POST', headers:{'Content-Type':'application/json','x-api-key':token},
    body: JSON.stringify({title, due})
  });
  document.getElementById('title').value='';
  document.getElementById('due').value='';
  fetchList();
}

async function complete(id){
  await fetch(apiBase + '/api/complete', {
    method:'POST', headers:{'Content-Type':'application/json','x-api-key':token},
    body: JSON.stringify({doc_id:id})
  });
  fetchList();
}

function playAudio(path){
  const a = new Audio(path);
  a.play();
}

async function ask(){
  const p = document.getElementById('prompt').value;
  const res = await fetch(apiBase + '/api/ask', {
    method:'POST', headers:{'Content-Type':'application/json','x-api-key':token},
    body: JSON.stringify({prompt:p, lang:'bn'})
  });
  const j = await res.json();
  document.getElementById('answer').innerText = j.answer || j.error || JSON.stringify(j);
  if(j.audio) playAudio(j.audio);
}

setInterval(fetchList, 6000);
fetchList();
</script>
</body>
</html>
